"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const http_status_1 = __importDefault(require("http-status"));
const formatError_1 = __importDefault(require("../responses/formatError"));
// NextFunction must be passed for Express to use this middleware as error handler
// eslint-disable-next-line @typescript-eslint/no-unused-vars
const errorHandler = (config, logger) => async (err, req, res, next) => {
    let response = formatError_1.default(err);
    let status = err.status || http_status_1.default.INTERNAL_SERVER_ERROR;
    logger.error(err.stack);
    if (config.debug && config.debug === true) {
        response.stack = err.stack;
    }
    if (req.collection && typeof req.collection.config.hooks.afterError === 'function') {
        ({ response, status } = await req.collection.config.hooks.afterError(err, response) || { response, status });
    }
    if (typeof config.hooks.afterError === 'function') {
        ({ response, status } = await config.hooks.afterError(err, response) || { response, status });
    }
    res.status(status).send(response);
};
exports.default = errorHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3JIYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2V4cHJlc3MvbWlkZGxld2FyZS9lcnJvckhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw4REFBcUM7QUFJckMsMkVBQThFO0FBTTlFLGtGQUFrRjtBQUNsRiw2REFBNkQ7QUFDN0QsTUFBTSxZQUFZLEdBQUcsQ0FBQyxNQUF1QixFQUFFLE1BQWMsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLEdBQWEsRUFBRSxHQUFtQixFQUFFLEdBQWEsRUFBRSxJQUFrQixFQUEyQyxFQUFFO0lBQ3pMLElBQUksUUFBUSxHQUFHLHFCQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hDLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLElBQUkscUJBQVUsQ0FBQyxxQkFBcUIsQ0FBQztJQUU1RCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUV4QixJQUFJLE1BQU0sQ0FBQyxLQUFLLElBQUksTUFBTSxDQUFDLEtBQUssS0FBSyxJQUFJLEVBQUU7UUFDekMsUUFBUSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO0tBQzVCO0lBRUQsSUFBSSxHQUFHLENBQUMsVUFBVSxJQUFJLE9BQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsS0FBSyxVQUFVLEVBQUU7UUFDbEYsQ0FBQyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7S0FDOUc7SUFFRCxJQUFJLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLEtBQUssVUFBVSxFQUFFO1FBQ2pELENBQUMsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztLQUMvRjtJQUVELEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3BDLENBQUMsQ0FBQztBQUVGLGtCQUFlLFlBQVksQ0FBQyJ9