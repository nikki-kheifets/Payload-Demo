"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const graphql_1 = require("graphql");
const formatName_1 = __importDefault(require("../../graphql/utilities/formatName"));
function registerGlobals() {
    if (this.config.globals) {
        const { findOne, update, } = this.graphQL.resolvers.globals;
        Object.keys(this.globals.config).forEach((slug) => {
            const global = this.globals.config[slug];
            const { label, fields, } = global;
            const formattedLabel = formatName_1.default(label);
            global.graphQL = {};
            global.graphQL.type = this.buildObjectType(formattedLabel, fields, formattedLabel);
            global.graphQL.mutationInputType = new graphql_1.GraphQLNonNull(this.buildMutationInputType(formattedLabel, fields, formattedLabel));
            this.Query.fields[formattedLabel] = {
                type: global.graphQL.type,
                args: {
                    ...(this.config.localization ? {
                        locale: { type: this.types.localeInputType },
                        fallbackLocale: { type: this.types.fallbackLocaleInputType },
                    } : {}),
                },
                resolve: findOne(global),
            };
            this.Mutation.fields[`update${formattedLabel}`] = {
                type: global.graphQL.type,
                args: {
                    data: { type: global.graphQL.mutationInputType },
                },
                resolve: update(global),
            };
        });
    }
}
exports.default = registerGlobals;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nbG9iYWxzL2dyYXBocWwvaW5pdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHFDQUF5QztBQUN6QyxvRkFBNEQ7QUFFNUQsU0FBUyxlQUFlO0lBQ3RCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7UUFDdkIsTUFBTSxFQUNKLE9BQU8sRUFBRSxNQUFNLEdBQ2hCLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDO1FBRW5DLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNoRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QyxNQUFNLEVBQ0osS0FBSyxFQUNMLE1BQU0sR0FDUCxHQUFHLE1BQU0sQ0FBQztZQUVYLE1BQU0sY0FBYyxHQUFHLG9CQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFekMsTUFBTSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFFcEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FDeEMsY0FBYyxFQUNkLE1BQU0sRUFDTixjQUFjLENBQ2YsQ0FBQztZQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLEdBQUcsSUFBSSx3QkFBYyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FDL0UsY0FBYyxFQUNkLE1BQU0sRUFDTixjQUFjLENBQ2YsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUc7Z0JBQ2xDLElBQUksRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUk7Z0JBQ3pCLElBQUksRUFBRTtvQkFDSixHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO3dCQUM3QixNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUU7d0JBQzVDLGNBQWMsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFO3FCQUM3RCxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7aUJBQ1I7Z0JBQ0QsT0FBTyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUM7YUFDekIsQ0FBQztZQUVGLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsY0FBYyxFQUFFLENBQUMsR0FBRztnQkFDaEQsSUFBSSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSTtnQkFDekIsSUFBSSxFQUFFO29CQUNKLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixFQUFFO2lCQUNqRDtnQkFDRCxPQUFPLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQzthQUN4QixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7S0FDSjtBQUNILENBQUM7QUFFRCxrQkFBZSxlQUFlLENBQUMifQ==