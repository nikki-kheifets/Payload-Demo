"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const terser_webpack_plugin_1 = __importDefault(require("terser-webpack-plugin"));
const mini_css_extract_plugin_1 = __importDefault(require("mini-css-extract-plugin"));
const css_minimizer_webpack_plugin_1 = __importDefault(require("css-minimizer-webpack-plugin"));
const webpack_bundle_analyzer_1 = require("webpack-bundle-analyzer");
const path_1 = __importDefault(require("path"));
const getBaseConfig_1 = __importDefault(require("./getBaseConfig"));
exports.default = (payloadConfig) => {
    const baseConfig = getBaseConfig_1.default(payloadConfig);
    let config = {
        ...baseConfig,
        output: {
            publicPath: `${payloadConfig.routes.admin}/`,
            path: path_1.default.resolve(process.cwd(), 'build'),
            filename: '[name].[chunkhash].js',
            chunkFilename: '[name].[chunkhash].js',
        },
        mode: 'production',
        stats: 'errors-only',
        optimization: {
            minimizer: [new terser_webpack_plugin_1.default({}), new css_minimizer_webpack_plugin_1.default()],
            splitChunks: {
                cacheGroups: {
                    styles: {
                        name: 'styles',
                        test: /\.(sa|sc|c)ss$/,
                        chunks: 'all',
                        enforce: true,
                    },
                },
            },
        },
        plugins: [
            ...baseConfig.plugins,
            new mini_css_extract_plugin_1.default({
                filename: '[name].css',
                ignoreOrder: true,
            }),
        ],
    };
    config.module.rules.push({
        test: /\.(scss|css)$/,
        sideEffects: true,
        use: [
            mini_css_extract_plugin_1.default.loader,
            require.resolve('css-loader'),
            {
                loader: require.resolve('postcss-loader'),
                options: {
                    postcssOptions: {
                        plugins: [require.resolve('postcss-preset-env')],
                    },
                },
            },
            require.resolve('sass-loader'),
        ],
    });
    if (process.env.PAYLOAD_ANALYZE_BUNDLE) {
        config.plugins.push(new webpack_bundle_analyzer_1.BundleAnalyzerPlugin());
    }
    if (payloadConfig.admin.webpack && typeof payloadConfig.admin.webpack === 'function') {
        config = payloadConfig.admin.webpack(config);
    }
    return config;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0UHJvZENvbmZpZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy93ZWJwYWNrL2dldFByb2RDb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxrRkFBbUQ7QUFDbkQsc0ZBQTJEO0FBQzNELGdHQUE4RDtBQUM5RCxxRUFBK0Q7QUFDL0QsZ0RBQXdCO0FBR3hCLG9FQUE0QztBQUU1QyxrQkFBZSxDQUFDLGFBQThCLEVBQWlCLEVBQUU7SUFDL0QsTUFBTSxVQUFVLEdBQUcsdUJBQWEsQ0FBQyxhQUFhLENBQVEsQ0FBQztJQUV2RCxJQUFJLE1BQU0sR0FBa0I7UUFDMUIsR0FBRyxVQUFVO1FBQ2IsTUFBTSxFQUFFO1lBQ04sVUFBVSxFQUFFLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUc7WUFDNUMsSUFBSSxFQUFFLGNBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sQ0FBQztZQUMxQyxRQUFRLEVBQUUsdUJBQXVCO1lBQ2pDLGFBQWEsRUFBRSx1QkFBdUI7U0FDdkM7UUFDRCxJQUFJLEVBQUUsWUFBWTtRQUNsQixLQUFLLEVBQUUsYUFBYTtRQUNwQixZQUFZLEVBQUU7WUFDWixTQUFTLEVBQUUsQ0FBQyxJQUFJLCtCQUFjLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxzQ0FBa0IsRUFBRSxDQUFDO1lBQzdELFdBQVcsRUFBRTtnQkFDWCxXQUFXLEVBQUU7b0JBQ1gsTUFBTSxFQUFFO3dCQUNOLElBQUksRUFBRSxRQUFRO3dCQUNkLElBQUksRUFBRSxnQkFBZ0I7d0JBQ3RCLE1BQU0sRUFBRSxLQUFLO3dCQUNiLE9BQU8sRUFBRSxJQUFJO3FCQUNkO2lCQUNGO2FBQ0Y7U0FDRjtRQUNELE9BQU8sRUFBRTtZQUNQLEdBQUcsVUFBVSxDQUFDLE9BQU87WUFDckIsSUFBSSxpQ0FBb0IsQ0FBQztnQkFDdkIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFdBQVcsRUFBRSxJQUFJO2FBQ2xCLENBQUM7U0FDSDtLQUNGLENBQUM7SUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDdkIsSUFBSSxFQUFFLGVBQWU7UUFDckIsV0FBVyxFQUFFLElBQUk7UUFDakIsR0FBRyxFQUFFO1lBQ0gsaUNBQW9CLENBQUMsTUFBTTtZQUMzQixPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztZQUM3QjtnQkFDRSxNQUFNLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDekMsT0FBTyxFQUFFO29CQUNQLGNBQWMsRUFBRTt3QkFDZCxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7cUJBQ2pEO2lCQUNGO2FBQ0Y7WUFDRCxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQztTQUMvQjtLQUNGLENBQUMsQ0FBQztJQUVILElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRTtRQUN0QyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLDhDQUFvQixFQUFFLENBQUMsQ0FBQztLQUNqRDtJQUVELElBQUksYUFBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksT0FBTyxhQUFhLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxVQUFVLEVBQUU7UUFDcEYsTUFBTSxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzlDO0lBRUQsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFDIn0=